# session_00002_bloat-scan Task Checklist
- [x] Step-01 – Conversation Context/Binding 拆分与单测（PYTHONPATH=src + pytest，日志：AI_WorkSpace/Scripts/session_00002_bloat-scan/Step-01_pytest.log）
- [x] Step-02 – Guard/TaskEnqueue/ResponseBuilder + ack 多语言（新模块拆分 + pytest 组合，integration 测试文件缺失已记录于 Step-02_pytest.log）
- [x] Step-03 – FastAPI Housekeeping & CapabilityService（拆分 startup_housekeeping/capability_service/health_routes，运行 `pytest tests/integration/test_health_probes.py` + `curl /healthz`，证据：`AI_WorkSpace/Scripts/session_00002_bloat-scan/Step-03_*.log/json`）
- [x] Step-04 – 依赖工厂分域（拆分 dependencies package、更新 routers、运行 `pytest tests/interface_entry/http/test_dependencies.py` + `curl /api/channel-bindings/dummy-id`，证据：`AI_WorkSpace/Scripts/session_00002_bloat-scan/Step-04_*`）
- [x] Step-05 – Workflow Repository + History（重构 repository 模块 + history 仓储 + `scripts/rehydrate_workflow_history.py`；运行 `PYTHONPATH=src pytest tests/business_service/workflow -k repository` 与 `python scripts/rehydrate_workflow_history.py --workflow wf-demo --apply --limit 5`，证据：`AI_WorkSpace/Scripts/session_00002_bloat-scan/Step-05_pytest.log`, `Step-05_rehydrate.log`）
- [x] Step-06 – Telemetry EventBus & Coverage + 脚本（完成 `event_bus`/`console_view`/`coverage_recorder` 拆分与引用更新，运行 `PYTHONPATH=src pytest tests/foundational_service/telemetry/test_event_bus.py`、`Step-06_seed_coverage.py`、`Step-06_telemetry_probe.py`（含 `POST /api/workflows/wf-demo/tests/run`）以及 `python scripts/rotate_telemetry.sh --dry-run`，证据：`AI_WorkSpace/Scripts/session_00002_bloat-scan/Step-06_pytest.log`, `Step-06_probe.log`, `Step-06_rotate.log`）
- [x] Step-07 – Up Channel Form 模块化 + Vitest/E2E（`WorkflowChannelForm.vue` 重构 + `useChannelForm` composable + 子组件 + `channelPolicy` DTO 分段；命令：`corepack pnpm vitest run tests/unit/ChannelCredentialCard.spec.ts tests/unit/ChannelFormShell.spec.ts`（日志：`AI_WorkSpace/Scripts/session_00002_bloat-scan/Step-07_vitest.log`），Chrome DevTools 采样记录：`Step-07_devtools_{snapshot,console,network}.txt`）
- [x] Step-08 – WorkspaceShell + Nav Store + 脚本（拆分 WorkspaceShell/layout/store/views、LogsPanel 事件，与 `corepack pnpm vitest run tests/unit/workspaceNav.spec.ts`、`node Step-08_workspace_nav.mjs --tabs nodes,prompts,workflow`、chromedevtoolmcp 证据 `Step-08_nodes_snapshot.txt`/`Step-08_nodes_console.txt`/`Step-08_nodes_network.txt`/`Step-08_nodes.png`、`Step-08_prompts.png`、`Step-08_workflow.png` 完成）
- [x] Step-09 – Workflow Builder Hooks + SSE（拆分 Workflow Builder controller→`useWorkflowCrud/useWorkflowLogs/useWorkflowMeta/useChannelTestGuard`、更新 `WorkflowBuilder.vue` 与 `WorkflowLogStream.vue`、重写 `pipelineSseClient.js`/`logService.js` 以支持 retry-after；命令：`corepack pnpm vitest run tests/unit/useWorkflowCrud.spec.ts tests/unit/useWorkflowLogs.spec.ts`（日志：`AI_WorkSpace/Scripts/session_00002_bloat-scan/Step-09_vitest.log`）以及 `python tests/tools/telegram_e2e.py --mode mock --workflow publish-demo`（日志：`Step-09_telegram_mock.log`，记录 healthz + 401 缺少 actor header）；chromedevtoolmcp 采集 `/workspace/workflow` Snapshot/Console/Network + 截图 `Step-09_workflow.png`）
- [x] Step-10 – Workflow Editor & Form（`useWorkflowForm` + `PromptBindingTable/ExecutionStrategyForm` 拆分，`corepack pnpm vitest run tests/unit/WorkflowEditor.spec.ts tests/unit/PromptBindingTable.spec.ts`，证据：`AI_WorkSpace/Scripts/session_00002_bloat-scan/Step-10_vitest.log` + `Step-10_workflow_{snapshot,console,network}.txt`）
- [x] Step-11 – Runbook/脚本整合与 Observability（修复 Mongo rs host + 重新播种 `wf-demo/2427173f` 数据；补丁 `src/business_service/channel/service.py` + `scripts/refresh_binding.py` 并以 `Step-11_pytest_channel.log` 通过单测；`python AI_WorkSpace/Scripts/session_00002_bloat-scan/Step-11_run_ops_matrix.py ...` → `Step-11_ops_matrix_summary.json` overall=ok，证据含 `Step-11_refresh_*.json`, `Step-11_healthz.png`, `Step-11_workspace_nodes.png`）
- [ ] Step-12 – 端到端回归 & 发布门禁
