# 测试系统快速参考

**版本**：2.0 | **1页速查**

---

## 5步工作流

```bash
# Step 1: 生成测试场景（必需，5-10分钟）
codex -p .codex/prompts/TestScenarioAnalysis_V2.md

# Step 2: 精化场景（可选，2-5分钟）
codex -p .codex/prompts/TestScenarioSpecify_V2.md -a "你的补充需求"

# Step 3: 生成测试计划（必需，3-5分钟）
codex -p .codex/prompts/TestPlanGeneration_V2.md

# Step 4: 生成技术决策（必需，5-8分钟）
codex -p .codex/prompts/TestTechDecisions_V2.md

# Step 5: 执行测试（必需，10-30分钟）
codex -p .codex/prompts/TestExecuteAndDebug_V2.md
```

---

## 常用命令

### 生成测试

```bash
# 完整5步（复制粘贴即可）
codex -p .codex/prompts/TestScenarioAnalysis_V2.md && \
codex -p .codex/prompts/TestPlanGeneration_V2.md && \
codex -p .codex/prompts/TestTechDecisions_V2.md && \
codex -p .codex/prompts/TestExecuteAndDebug_V2.md
```

### 运行测试（测试组件已存在）

```bash
cd Kobe/SimulationTest/{MODULE_NAME}_testplan

# 检查环境
python run_tests.py --check-only

# 运行P0场景（核心）
python run_tests.py --priority p0

# 运行所有场景
pytest test_cases/

# 并行运行（4个worker）
pytest -n 4 test_cases/

# 查看报告
open results/report.html
```

### 调试失败的测试

```bash
# 1. 查看报告
open results/report.html

# 2. 查看日志
cat logs/by_scenario/scenario_X_X.log

# 3. 复现失败（使用日志中的随机种子）
TEST_RANDOM_SEED=123456 pytest test_cases/ -k "scenario_X_X"

# 4. AI自动调试
codex -p .codex/prompts/TestExecuteAndDebug_V2.md
```

---

## 7个测试维度

1. **功能覆盖**：正常、异常、边界
2. **数据多样性**：小/中/大、特殊字符
3. **并发性能**：10并发、100并发
4. **配置分支**：Redis开/关、各种配置
5. **异常恢复**：超时、重启
6. **依赖服务**：服务宕机
7. **真实场景**：用户完整流程

---

## 智能Debugging（5个维度）

AI失败时会自动诊断：

1. **项目背景**：读需求文档，理解开发意图
2. **基础设施**：服务启动了吗？（最常见问题！）
3. **配置环境**：配置正确吗？
4. **代码实现**：功能实现了吗？
5. **测试本身**：测试合理吗？

**核心原则**：从源头考虑问题，不是死磕bug

---

## 输出文件

| 步骤 | 输出文件 | 位置 |
|------|---------|------|
| Step 1 | 测试场景文档 | `SimulationTest/{MODULE}_testscenarios.md` |
| Step 3 | 测试计划文档 | `SimulationTest/{MODULE}_testplan.md` |
| Step 4 | 技术决策文档 | `SimulationTest/{MODULE}_testtech.md` |
| Step 5 | 测试组件目录 | `SimulationTest/{MODULE}_testplan/` |
| Step 5 | 测试报告 | `...testplan/results/report.html` |
| Step 5 | Debugging报告 | `...testplan/debugging_reports/` |

---

## 典型场景

### 场景1：新功能测试

```bash
# 前提：已完成开发工作流，有DevPlans/005_XXX/
codex -p .codex/prompts/TestScenarioAnalysis_V2.md
# 审核testscenarios.md
codex -p .codex/prompts/TestPlanGeneration_V2.md
# 审核testplan.md
codex -p .codex/prompts/TestTechDecisions_V2.md
# 审核testtech.md
codex -p .codex/prompts/TestExecuteAndDebug_V2.md
# 查看results/report.html
```

### 场景2：精化场景

```bash
# 增加新场景
codex -p .codex/prompts/TestScenarioSpecify_V2.md -a "增加场景：测试100并发"

# 调整优先级
codex -p .codex/prompts/TestScenarioSpecify_V2.md -a "Scenario-1.3改为P0"

# 放宽验收标准
codex -p .codex/prompts/TestScenarioSpecify_V2.md -a "Scenario-1.2响应时间改为10分钟"
```

### 场景3：复现失败

```bash
# 从日志获取种子：Random Seed: 123456
TEST_RANDOM_SEED=123456 pytest test_cases/ -k "scenario_3_2" -vv
```

---

## 核心特点

| 特点 | 说明 |
|------|------|
| **完整组件** | 不是简单脚本，是完整的pytest项目 |
| **系统随机化** | 5种随机化策略，可复现 |
| **7个维度** | 全面覆盖功能、性能、容错、真实场景 |
| **智能Debugging** | 从5个维度系统性诊断，识别根本原因 |
| **工程级质量** | pytest生态、结构化日志、HTML报告 |

---

## 故障排查

| 问题 | 检查 | 解决方案 |
|------|------|---------|
| 服务连接失败 | `python run_tests.py --check-only` | 启动缺失的服务 |
| Celery任务pending | `ps aux \| grep celery` | 启动Celery worker |
| 随机失败 | 检查日志中的随机种子 | 用相同种子复现 |
| 内存不足 | 检查性能指标 | 减少并发数 |
| 配置错误 | 检查test_config.py | 修正配置 |

---

## 最佳实践

1. ✅ 开发完成后立即测试
2. ✅ P0场景必须100%通过
3. ✅ 失败时先看AI的Debugging报告
4. ✅ 保留测试组件，持续迭代
5. ✅ 定期运行回归测试

---

**更多详情**：查看 `CodexFeatured/测试系统使用指南.md`

**版本**：2.0 | **更新**：2025-10-11

