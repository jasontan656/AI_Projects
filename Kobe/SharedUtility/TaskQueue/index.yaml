meta:
  version: "1.0"
  schema_version: "1"
  path: "Kobe/SharedUtility/TaskQueue"
  last_updated: "2025-10-11"
  owners: ["kobe-taskqueue"]
  stability: "alpha"

module:
  name: "TaskQueue"
  summary: "基于 Celery 的任务队列封装：应用对象、任务定义与数据模型；支持通用注册与按名分发"
  responsibilities:
    - "提供 Celery app 对象（用于 worker 与调用）"
    - "内置演示任务 demo_long_io / demo_sharded_job"
    - "提供 Pydantic 请求/响应模型（任务名校验采用通用 slug）"
    - "提供注册/发送 API（registry.py）用于插件化扩展"
  non_goals:
    - "不负责外部消息中间件运维，仅封装接入"
  entry_points:
    - "__init__.py"
    - "app.py"
    - "tasks.py"
    - "registry.py"

relations:
  depends_on: []
  used_by:
    - "Kobe"
    - "Kobe/routers"
  provides_apis:
    - "__init__.py: app"
    - "tasks.py: long_io"
    - "tasks.py: sharded_job"
    - "schemas.py: TaskStart"
    - "schemas.py: TaskStatus"
    - "schemas.py: TaskResult"
    - "registry.py: task"
    - "registry.py: send_task"
    - "registry.py: get_allowed_tasks_from_env"
  reasons:
    - "为路由层提供统一的任务提交与查询能力"

files:
  key_files:
    - "__init__.py"
    - "app.py"
    - "tasks.py"
    - "schemas.py"
    - "config.py"
    - "readme.md"
  test_locations: []

sub_indexes:
  - "repository/index.yaml"

notes:
  - "如需启用结果后端，请在 .env 中配置并更新 celery app 设置"
  - "通过 .env 的 ALLOWED_TASKS 控制可用任务名；留空则仅按 slug 校验"
