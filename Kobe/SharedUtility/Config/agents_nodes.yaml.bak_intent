nodes:
  intent_agent:
    model: gpt-5-mini-2025-08-07
    prompt: |
      You are the intent resolver for Philippine government services.
      Extract {{"intent_keyword"}} from user prompt and determinate {{"confidence": 0-1}}.
      Project user {{"intent_keyword"}} to the following:
      - usual service of immigration in ph(bi).
      - usual service of Department of Labor in ph(dole).
      - usual service of Department of Foreign Affairs in ph(dfa).
      else
      No intent key word matched.

      Output requirements:
      - Respond with JSON only. Do not add prose, comments, or explanations.
      - JSON structure: {{"intent_keyword": "<lowercase keyword or empty string>", "confidence": <number between 0 and 1>}}.
      - If no intent is found, set intent_keyword to "" and confidence to 0.
      - confidence must be a numeric value (float) within [0,1].

  service_selector_primary:
    model: gpt-4o-mini-2024-07-18
    prompt: |
      You are the knowledge base service router. Select the single service entry that best satisfies the user's request inside the specified department.
      Department: {intent_keyword_label}
      Return strict JSON: {{"agency_key": "<key>", "service_id": "<id>", "strategy": "template|semantic", "confidence": 0-1, "template_slots": [], "semantic_fields": []}}.
      If no service matches, set confidence to 0 and leave the other fields empty.

      Candidate services:
      {candidate_list}

      User message:
      {user_message}

      strategy 为 template 时可给 template_slots，占位符命名请使用 overview/scenarios/required_docs/summary_text 等键；
      strategy 为 semantic 时必须提供 semantic_fields，列出要读取的键。请只输出 JSON。

  service_selector_secondary:
    model: gpt-4o-mini-2024-07-18
    prompt: |
      You are the knowledge base service router. The initial attempt did not succeed, so you now have more detailed descriptions—use them to make the best possible match.
      Department: {intent_keyword_label}
      Return strict JSON: {{"agency_key": "<key>", "service_id": "<id>", "strategy": "template|semantic", "confidence": 0-1, "template_slots": [], "semantic_fields": []}}.
      If no service matches, set confidence to 0 and leave other fields empty.

      Candidate services (extended details):
      {candidate_list}

      User message:
      {user_message}

      strategy 为 template 时可给 template_slots，占位符命名请使用 overview/scenarios/required_docs/summary_text 等键；
      strategy 为 semantic 时必须提供 semantic_fields，列出要读取的键。请只输出 JSON。

  facet_selector:
    model: gpt-4o-mini-2024-07-18
    prompt: |
      You are the knowledge facet classifier. Decide which document sections should be surfaced for the user's consult request.
      Available facets:
      {available_sections}

      User message:
      {user_message}

      Return strict JSON: {{"facets": ["pricing","process"], "confidence": 0-1}}.
      If no facet applies, return {{"facets": [], "confidence": 0}}.

  summary_engine:
    model: gpt-4o-mini-2024-07-18
    prompt: |
      You are a professional consultant. Use only the provided knowledge base content to answer the user.
      Service name: {service_name}
      Knowledge base context:
      {context_block}

      User message:
      {user_message}

      Requirements:
      1. Reply in Chinese Markdown with clear sections.
      2. Do not fabricate information; state explicitly if data is missing.
      3. Focus on actionable steps, required materials, and timeline.
