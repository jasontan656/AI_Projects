meta:
  version: "1.0"
  schema_version: "1"
  path: "Kobe/mcpServer"
  last_updated: "2025-10-15"
  owners:
    - "kobe-core"
  stability: "beta"
module:
  name: "mcpServer"
  summary: "基于 Streamable HTTP 的 MCP Server 实现，提供统一工具发现与调用能力"
  responsibilities:
    - "实现 JSON-RPC 2.0 协议处理与 MCP 方法路由"
    - "提供 SSE 事件流推送，支持一对多客户端连接"
    - "集成现有 LangChain 工具，自动注册到 MCP 工具注册表"
    - "提供 Bearer Token 鉴权与基于 X-Agent-Id 的会话隔离"
    - "实现速率限制、结构化日志与错误处理"
  non_goals:
    - "不替代 Kobe/api/mcp_stdio_server.py 的 STDIO 实现"
    - "不直接提供前端界面"
    - "不作为独立服务部署，而是集成到主应用"
  entry_points:
    - "集成到根目录 app.py，通过 uvicorn app:app 启动"
relations:
  depends_on:
    - "Kobe/ChatTerminal/tools"
    - "Kobe/tools/langchain_tools.py"
  used_by:
    - "OpenAI Codex CLI / IDE 扩展"
    - "OpenAI Agents SDK"
    - "Vercel AI SDK"
    - "LangChain / LangGraph"
  provides_apis:
    - "POST /mcp"
    - "GET /mcp/stream"
    - "GET /health"
    - "GET /"
  reasons:
    - "提供标准化的 HTTP MCP 服务器，支持远程调用与多客户端并发"
files:
  key_files:
    - "__init__.py"
    - "models.py"
    - "protocol.py"
    - "sse_manager.py"
    - "auth.py"
    - "tools_registry.py"
    - "rate_limiter.py"
    - "test_client.py"
    - "README.md"
    - ".env.example"
  notes:
    - "app.py 和 main.py 已删除，功能已整合到根目录 app.py"
    - "启动脚本已更新为启动根目录 app.py"
  test_locations:
    - "test_client.py"
sub_indexes: []
notes:
  - "支持的 MCP 方法: tools/list, tools/call"
  - "内置 9 个工具: web_search, fetch_webpage, read_file, write_file, list_directory, search_files, execute_command, exa_search, playwright_capture"
  - "鉴权配置: 通过环境变量 MCP_AUTH_ENABLED 和 MCP_BEARER_TOKEN 控制"
  - "速率限制: 默认每个 Agent 每分钟最多 60 次请求"
  - "会话隔离: 通过 X-Agent-Id 请求头区分不同客户端"
  - "日志输出: 控制台结构化日志，格式: 时间 | 级别 | 模块 | 消息"
  - "SSE 心跳: 每 30 秒自动推送心跳事件，保持连接活跃"
