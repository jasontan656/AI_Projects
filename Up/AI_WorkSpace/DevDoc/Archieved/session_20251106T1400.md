# 用户意图
- 对齐 Up 前端与 Rise 后端重构产物，确保节点与提示词等模块的字段、命名、流程契约一致，明确需要补齐或修改的前端部分。
- 当前优先级：先覆盖 Rise 后端已经实现的字段/行为；前端可预留扩展字段，但需在后端占位清理后再推进新设计。前端仍是契约事实来源，将持续提供字段定义供后端跟进。

# 仓库上下文
- `src/services/pipelineService.js:6-125` – 节点 CRUD 请求封装，发送字段含 `name/allowLLM/actions/systemPrompt/createdAt/pipelineId/status/strategy`，查询参数为 `pipelineId/status/page/pageSize`。
- `src/services/promptService.js:1-87` – 提示词 CRUD 请求，字段为 `name/markdown`，列表接口默认返回 `items`。
- `src/utils/nodeActions.js:3-95` – 定义动作类型、序列化/归一化逻辑，仅保留 `templateId/legacyText/inputMapping/disabled` 配置键。
- `src/components/NodeDraftForm.vue:60-325` – 节点表单逻辑，创建/更新时沿用选中节点的 `pipelineId/status/strategy`，禁用 LLM 时阻止包含提示词动作。
- `src/components/NodeActionList.vue:118-275` – 动作增删改、右键菜单，`commit()` 会重排 `order` 并在根结点上写入 `disabled`。
- `src/stores/pipelineDraft.js:1-79` – Pinia 节点草稿 store，`replaceNodes()` 使用 `normalizeActions` 保障动作结构。
- `src/components/PromptEditor.vue:1-220` – 提示词编辑表单，提交后刷新 store，默认语言 `markdown`。
- `docs/contracts/pipeline-node-draft.json` – 前端输出给后端的节点契约，要求字段 `id/name/allowLLM/actions/systemPrompt/createdAt`，动作对象允许 `disabled` 属性。
- `docs/contracts/prompt-draft.json` – 提示词契约 `id/name/markdown/createdAt`。
- `docs/ProjectDev/*.md` – 各模块设计说明，确认前端是契约事实来源。

# 技术栈
- Vue 3 (Composition API) + Vite。
- Pinia 状态管理。
- Element Plus UI，@vue-flow/core 画布，Codemirror 6 编辑器。
- 辅助库：uuid、@vueuse/core。
- 请求 API 基于 `fetch`，基础地址 `import.meta.env.VITE_API_BASE_URL`（默认 `http://localhost:8000`）。

# 搜索结果
- Exa: “Create API Contracts (GraphQL, tRPC, oRPC) and Workarounds” (2025-08-26) – 强调前后端共享契约、运行时校验的重要性，提示可用 GraphQL/RPC 等模式。
- Exa: “API contracts and everything I wish I knew” (2025-07-23) – 前端视角的 API 契约指南，强调双边验证与工具化。

# 架构发现
- 前端发送的节点创建/更新 payload 未包含动作根级的 `disabled`，与契约允许字段不完全对应；若后端依赖 `disabled` 标记，需要扩展 `serializeActionsForApi()`（`src/utils/nodeActions.js:68-74`）。
- `pipelineService.createPipelineNode()` 默认写入 `strategy: {}` 与 `status: payload?.status || "draft"`（`src/services/pipelineService.js:59-67`）；需确认后端模型是否接受空对象及默认状态，否则应同步默认值或在表单中显式管理。
- `listPipelineNodes()` 仅设置 `pipelineId`、`status` 查询参数（`src/services/pipelineService.js:106-115`）；若后端新增过滤条件（如 `namespace`、`version`），需扩展前端。
- `NodeDraftForm.handleSubmit()` 在更新时盲传选中节点的 `pipelineId/status/strategy`（`src/components/NodeDraftForm.vue:204-233`）；当后端返回新字段或重命名时会丢失或覆盖，需基于最新契约重构 payload 组装。
- `nodeActions.sanitizeConfig()` 会丢弃除白名单外的配置项（`src/utils/nodeActions.js:11-19`）；若后端引入新动作配置键（如 `outputVariable`、`toolName`），需同步白名单。
- 提示词更新允许 `name` 为空字符串（`src/services/promptService.js:41-59` + `PromptEditor` 未强制校验），但契约要求 `name` 最小长度 1，需在前端补充验证与默认值。
- API 响应预期：前端兼容 `items` 包裹或直接数组（`NodeDraftForm.fetchNodes()` 与 `PromptEditor.fetchPrompts()`），应确认后端统一格式并据此简化逻辑。
- 变量面板、日志面板当前为静态/模拟数据；后端上线后需提供真实 API 与数据契约（SSE/WebSocket、Redis 查询），避免占位字段未对齐。
- 无法读取 `D:\AI_Projects\Rise` 后端文档（受 repo 限制），需要由用户提供最新 API 契约或映射表以完成逐字段核对。
- Rise 后端现阶段存在大量占位符，需以其实际返回/接受的字段为准执行第一轮对齐，避免前端发送未被识别的键造成 422。待后端按前端契约补全后再迭代新的前端字段。
- 现读取 Rise 仓库：`PipelineNodeRequest` 字段为 `name/allowLLM/systemPrompt/createdAt` 与可选 `pipelineId/status/strategy`（`src/interface_entry/http/pipeline_nodes/dto.py:11-33`），响应为 `ApiResponse` 包裹 `PipelineNodeResponse`（含 `latestSnapshot` 和 `version` 字段），不存在 `actions` 存储。
- `PipelineNodeService` 在创建/更新时仅持久化上述字段并忽略 `actions`（`src/business_service/pipeline/service.py:19-84`），当前策略字段默认为空字典。
- Prompt 模块 DTO 要求 `name`、`markdown` 均为最小 1 长度，分页参数同样限制 1..100，返回 `ApiResponse[PromptListResponse]`（`src/interface_entry/http/prompts/dto.py:11-38`、`routes.py:18-102`）。
- 后端错误结构标准化为 `{code, message}`，可能返回 `NODE_NAME_CONFLICT`、`INVALID_PAGE_SIZE` 等错误码（`src/interface_entry/http/pipeline_nodes/routes.py:32-123`、`prompts/routes.py:33-99`）。
- 后端列表接口始终返回分页元数据 `meta.pagination`，前端可借此去除对“纯数组”兼容逻辑。
- 前端服务层已重构：`src/services/httpClient.js` 统一注入 `X-Actor-*` 标头、处理 `{code,message}`；`pipelineService.js` / `promptService.js` 基于字段白名单构建请求体、校验 ISO 时间与分页范围并返回 `ApiResponse` 中的 `data/meta`。节点表单新增提示语说明动作仅保留在前端草稿，列表刷新与提示词拉取均改用 `data.items`，提示词编辑器强制名称非空并在报错时映射到对应输入框。

# 新增文档
- `AI_WorkSpace/DevDoc/On/frontend_backend_alignment_phase1.md`：归档阶段一对齐要求，涵盖成功流程、失败模式、防御策略以及 GIVEN/WHEN/THEN 验收检查。

# 待确认 / 下一步
- 后端节点/提示词模型的最终字段名（camelCase vs snake_case）、必填属性及默认值。
- 动作 `config` 是否新增键或嵌套结构；若后端为 Pydantic 模型需提供示例。
- `strategy`、`status`、`pipelineId` 的业务含义与枚举值，以便在前端暴露控件或校验。
- 删除接口返回格式（204 vs JSON）以及错误结构，便于前端完善提示。
- 真实日志/变量接口的协议（SSE 路径、WebSocket 事件名、鉴权方式）。
